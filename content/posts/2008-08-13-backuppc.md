---
title: BackupPC
author: Miguel Alho
type: post
date: 2008-08-13T18:57:03+00:00
url: /backuppc/
categories:
  - 'Code &amp; IT'
tags:
  - BackupPC
  - configira√ß√µes
  - cygwin
  - firewall
  - Linux
  - rsync
  - rsyncd
  - Vista
  - Windows
  - XP

---
<a href="http://backuppc.sourceforge.net/info.html" target="_blank"><img src="http://backuppc.sourceforge.net/images/icons/BackupPC/mid/logo.gif" alt="" /></a>

Em tempos, neste blog, inclui uma <a href="http://miguelalho.com/?tag=tech-week" target="_blank">s√©rie de posts dedicados a backups</a>. Uma das solu√ß√µes que mencionei foi o BackupPC, uma aplica√ß√£o Linux que permite efectuar backups de maquinas em Linux, Windows e at√© MAC, via a rede.

Durante o √∫ltimo ano tive uma m√°quina recuperada a funcionar na Miseric√≥rdia local com a aplica√ß√£o, a efectuar backups dos dados das v√°rias esta√ß√µes de trabalho e servidores. Infelizmente a minha primeira configura√ß√£o n√£o resultou completamente. Parte do problema foi a configura√ß√£o efectuada ao n√≠vel dos discos no Linux &#8211; o mount point do disco para os backups n√£o deveria estar bem configurado, e com qualquer _reboot_ da m√°quina, o disco n√£o era montado e o servi√ßo de backup n√£o arrancava. Parte do problema deveria ser do pr√≥prio BackupPC a funcionar com o samba (um servi√ßo do Linux que permite comunicar/partilhar com o Windows) &#8211; n√£o conseguia copiar os dados das pastas _Document and Settings_ correctamente. Decidi actualizar o Linux e refazer a configura√ß√£o, desta vez utilizando o rsync para efectuar a comunica√ß√£o.

Como disse, a m√°quina √© um PC recuperado &#8211; um Pentium 4 a 1.6Ghz com 512MB de RAM, um disco de 20GB + 500GB, e uma placa de rede 1GB. Funciona bem com o Ubuntu (_desktop_) em cima (escolhi a vers√£o _desktop_ pela interface gr√°fica). Desta vez, na instala√ß√£o, decidi acertar os pontos de montagem. O disco de 20GB foi divido em tr√™s &#8211; 10GB montado em / em ext3, 5GB montado em _/home_, tamb√©m em ext3 e os restantes 5GB como swap. Para finalizar, montei o disco de 500Gb em _/var/lib/backuppc_ (a pasta onde o BackupPC armazena os dados) no sistema de ficheiros ReiserFS, que tem _journaling_ e aparenta ser bom com ficheiros pequenos. Finalmente, um dos problemas originais ficou resolvido &#8211; tendo configurado os pontos de montagem logo na instala√ß√£o, o segundo disco √© montado correctamente no arranque, e o servi√ßo do BackupPC pode arrancar no arranque, correctamente, tamb√©m.

Com o Ubuntu a funcionar e actualizado (8.04 + actualiza√ß√µes), instalei o BackupPC via o Synaptics. Surgiu um problema com a configura√ß√£o do BackupPC no Apache, que foi facilmente resolvido &#8211; tive de trocar a configura√ß√£o de Apache para Apache2. Um tutorial simples pode ser <a href="http://www.howtoforge.com/linux_backuppc" target="_blank">visto no How To Forge</a>.</blockquote> 

Nota 20090206- Caso surgam problemas no acesso √† p√°gina (ou seja se o apache n encontrar a p√°gina do backuppc, pode ser necess√°rio executar mais um passo: copie e execute as seguintes linhas, como referido por &#8220;Girya&#8221; nos [foruns do Ubuntu][1]:

sudo chmod 777 /etc/apache2/apache2.conf  
sudo cat /etc/backuppc/apache.conf >> /etc/apache2/apache2.conf  
sudo chmod 644 /etc/apache2/apache2.conf  
sudo /etc/init.d/apache2 stop  
sudo /etc/init.d/apache2 start

_I was having the same problem as you. I don&#8217;t why backuppc won&#8217;t auto configure apache2 but I found this in a post by searching backuppc. it was posted by bgearig. It adds the required lines to the apache config file so apache can find backuppc._ </blockquote> 

A segunda parte √© (ou era) a mais complexa &#8211; a da configura√ß√£o do BackupPC. Felizmente o BackupPC cresceu a n√≠vel de funcionalidade e j√° n√£o √© necess√°rio editar os ficheiros de configura√ß√£o √† m√£o &#8211; o _backoffice_ web agora inclu√≠ formul√°rios de configura√ß√£o onde podemos indicar os valores dos par√¢metros gerais (como o modo de transfer√™ncia &#8211; _rsync/rsyncd/samba_), a partilha base de backup, o user e pass para o backup, periodicidade de backups, etc. Tamb√©m existe formul√°rios para efectuar a configura√ß√£o de par√¢metros para m√°quinas individuais (fazendo o _overide_ dos gerais).

Desta vez, na configura√ß√£o decidi utilizar o _rsync_ como m√©todo de transfer√™ncia. O _rsync_ √© nativo ao Linux para transfer√™ncia de ficheiros, mas existe um projecto chamado cygwin que inclui o _rsync_ a funcionar em Windows. E pelos vistos o rysnc √© melhor e mais eficiente que o samba na transfer√™ncia de ficheiros. O <a href="http://backuppc.sourceforge.net/" target="_blank">cygwin-rsync pode ser obtido no Sourceforge do BackupPC</a>, j√° quase quase configurado. O √∫nico &#8220;mal&#8221; de o _rsync_ √© que √© necess√°rio instalar/configurar em cada m√°quina. Mas correctamente gerido, √© at√© um processo r√°pido.

Um √≥ptimo tutorial para a configura√ß√£o est√° em <a href="http://gerwick.ucsd.edu/backuppc_manual/backuppc_winxp.html" target="_blank">http://gerwick.ucsd.edu/backuppc_manual/backuppc_winxp.html</a>. Ele indica uma forma correcta de instalar o _rsync_, que fica a trabalhar como servi√ßo no Windows. Basta copiar os ficheiros para a pasta C:\rsyncd , editar o ficheiro ._secrets_ com o user/pass e o ._conf_ com a informa√ß√£o da m√°quina host permitida e as pastas (ou drives) a transferir, e iniciar o servi√ßo. Por defeito, o ficheiro indica a pasta _c:\Document and Settings_ como uma das configura√ß√µes (&#8220;docs&#8221;)e o C:\ como a outra (&#8220;cDrive&#8221;). Nas maquinas onde havia mais que um disco, adicionei um &#8220;dDrive&#8221;. Criei tb um ficheio .bat na pasta com o conjunto de comandos para adicionar os servi√ßos:

<pre>cd \rsyncd
 cygrunsrv.exe -I rsyncd -e CYGWIN=nontsec -p c:/rsyncd/rsync.exe -a "--config=c:/rsyncd/rsyncd.conf --daemon --no-detach"
sc start rsyncd</pre>

Assim, bastava copiar a pasta para cada m√°quina, adicionar info aos .conf, caso necess√°rio, e executar o .bat para iniciar o servi√ßo. Caso houvesse _firewall_ a funcionar, tinha de abrir uma excep√ß√£o para o rsync que utiliza a porta 873. Simples!

A minha tarefa ficou bem mais simples desta forma. No BackupPC, adicionei cada uma das m√°quinas (√† medida que ia instalando o _rsync_) na lista de _Hosts_. A parte do _Xfer_ geral tem &#8211; _rsyncd_ como m√©todo de transfer√™ncia; &#8220;_cDrive_&#8221; e &#8220;_docs_&#8221; como partilhas base, o _user_ e _pass_ de acesso e a defini√ß√£o do porto de acesso. Caso a m√°quina necessitasse, adicionava a partilha &#8220;_dDrive_&#8221; como _override_ para a m√°quina. Tudo no _backoffice_ web. üòÄ

E agora sim, tenho o os documentos a serem copiados correctamente, podendo preservar correctamente os ficheiros de trabalho.

NOTA: Em m√°quinas Vista, conv√©m correr o .bat na linha de comandos iniciado como Administrador&#8230;

 [1]: http://ubuntuforums.org/showthread.php?t=797473